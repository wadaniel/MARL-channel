
import re
import os
import pickle
import time
import matplotlib.pyplot as plt
from multiprocessing import Pool

import numpy as np
from scipy.stats import norm


heights = [0.0, 0.1, 0.4, 1.0, 1.7, 
        2.7, 3.9, 10.6, 12.8, 15.2, 
        17.7, 20.4, 23.3, 26.4, 29.6, 
        32.9, 36.4, 40.0, 43.7, 47.6]   

ndata = len(heights)

usdev=[3.715115703501191e-15, 0.0014348695621996344, 0.005728445226425577, 0.012863755336055148, 0.022834049323251598, 
        0.035567512559093004, 0.050650844707304625, 0.06690275053965274, 0.08225899887364495, 0.09440972939226579, 
        0.10183240428535167, 0.10442368537475794, 0.10322373676264696, 0.09948443634461769, 0.09426974602050467, 
        0.08863420154382483, 0.0833968806321135, 0.07884661224824242, 0.0752149965040364, 0.07291356290615736]

usdevc=[3.688110137209064e-15, 0.009106061459156909, 0.03041707608612661, 0.05296559927287224, 0.07106030847144622, 0.08506587318696128, 0.09682847655059668, 0.10692644185186138, 0.11484854352204145, 0.12020938566788761, 0.12284903776644908, 0.1226230116447755, 0.11929533042153775, 0.11312005082797726, 0.1051091972714891, 0.09669472484157803, 0.08964023513902795, 0.08413963137743898, 0.07953197242449221, 0.07630160724575714]

vsdev=[7.217411799071074e-18, 3.307922591899531e-06, 5.082217949788947e-05, 0.00024068599648118132, 0.000694342631783115, 
        0.001513750060227319, 0.0027526456079209386, 0.004412345384623743, 0.006451615294886804, 0.00878785291678596, 
        0.011295239059245645, 0.013840547309136978, 0.016332330621928005, 0.018726109444498443, 0.021003906790192685, 
        0.02317143826383893, 0.02521845535750823, 0.027078884229627096, 0.028737569101782795, 0.030261998673022417]

vsdevc=[0.03939160498857401, 0.03937681410294568, 0.039172153109673195, 0.03841828795465835, 0.03683987095075158, 0.034483635295611235, 0.03177352720422979, 0.02933351863083976, 0.02764126616133696, 0.026782450978775924, 0.026519636046071916, 0.026562396071151007, 0.026778482843778727, 0.027087068277397316, 0.027448931660032594, 0.02803577205579265, 0.028934735870536375, 0.029973987635575936, 0.030983700779909397, 0.03193371844985744]

ucorr = [0.001989829819968659, 0.9999217414193313, 0.9997349695739204, 0.9984437649124285, 0.9944923005964045, 
        0.9853059389490135, 0.9674737357222654, 0.9381297048959766, 0.8967965244126544, 0.8464066980653513, 
        0.7920454613529506, 0.737823295406623, 0.6860839019880528, 0.6398695986883169, 0.6020399608506514, 
        0.5708890739343415, 0.5427179491494589, 0.5180625589203594, 0.4981591474015895, 0.4812778630472117]
ucorrc=[-0.004332348481224023, 0.9998652856905826, 0.9974057323054606, 0.98315048096125, 0.9468853775401219, 0.8828769344658627, 0.7923219923299663, 0.6843659806424061, 0.5716592432775394, 0.46508474695242474, 0.3729551757076866, 0.2987019719935194, 0.2406354721890656, 0.19682503604871224, 0.1673182937712711, 0.15164198857111655, 0.14683382921642008, 0.14583273778875966, 0.14402202626191435, 0.14045556886145613]

vcorr = [-0.019682970368508322, -0.2976529197437991, -0.30717386809119984, -0.3231927071496066, -0.3457032031901507, 
        -0.374146882828966, -0.4066455677470353, -0.4390965823138959, -0.4653337108058079, -0.4797238985414494, 
        -0.48058530426733187, -0.47090979792264775, -0.4565839173514067, -0.4435950242074598, -0.4352131389970174, 
        -0.4304128543670375, -0.4251362075504528, -0.41493042407008096, -0.39665445746925937, -0.37073790002814455]

vcorrc=[-0.7015534803463543, -0.701538609534344, -0.7014035174598992, -0.7011050160939407, -0.7002175452317678, -0.6962574205552489, -0.6829953228778753, -0.6519104837286906, -0.5993948166649105, -0.5326782555328259, -0.4643065950514823, -0.4020971368350177, -0.3474048636159812, -0.3005192038993042, -0.2619225072686431, -0.2298784334214562, -0.20282831753792868, -0.18113703189683428, -0.16422052956739114, -0.15061194685400695]

utilu=[3.715115703501191e-15, 0.0004348695621996344, 0.001863755336055148, 0.002834049323251598, 0.005567512559093004, 
0.0650844707304625, 0.080275053965274, 0.225899887364495, 0.1440972939226579, 0.1368537475794, 
0.1037475794, 0.09422373676264696, 0.05948443634461769, 0.0426974602050467, 0.03420154382483, 
0.006321135, 0.004661224824242, 9.965040364e-15, 2.91356290615736e-15, 1.356290615736e-15]

utilv=[3.21135e-16, 4.6612248242423e-16, 9.965040364e-16, 2.91356290615736e-15, 3.715115703501191e-15, 
0.0004348695621996344, 0.001863755336055148, 0.002834049323251598, 0.005567512559093004, 0.00650844707304625, 
0.010275053965274, 0.01225899887364495, 0.0740972939226579, 0.1368537475794, 0.088537475794, 
1.322373676264696e-15, 9.484436344617691e-16, 4.26974602050467e-16, 3.420154382483e-16, 1.20154382483e-16]

fName = f'stats_heights.png'

fig, ax = plt.subplots(2,2)
ax[0,0].plot(heights, usdev, linestyle='-', lw=1, marker='^', markersize=4, color='cornflowerblue')
ax[0,0].plot(heights, usdevc, linestyle='--', lw=1, marker='^', markersize=4, color='cornflowerblue')
#ax[0,0].set_title("Statistics u(h)")
ax[0,0].set_xticks(np.arange(0,60,15)) 
ax[0,0].set_xticklabels([]) 

ax[0,1].plot(heights[1:], ucorr[1:],  linestyle='-', lw=1, marker='v', markersize=4, color='turquoise')
ax[0,1].plot(heights[1:], ucorrc[1:],  linestyle='--', lw=1, marker='v', markersize=4, color='turquoise')
ax[0,1].set_xticks(np.arange(0,60,15)) 
ax[0,1].set_xticklabels([]) 

ax[1,0].plot(heights, vsdev, linestyle='-', lw=1, marker='^', markersize=4, color='cornflowerblue')
ax[1,0].plot(heights, vsdevc, linestyle='--', lw=1, marker='^', markersize=4, color='cornflowerblue')
#ax[1,0].set_title("Statistics v(h)")
ax[1,0].set_xticks(np.arange(0,60,15)) 

ax[1,1].plot(heights[1:], vcorr[1:], linestyle='-', lw=1, marker='v', markersize=4, color='turquoise')
ax[1,1].plot(heights[1:], vcorrc[1:], linestyle='--', lw=1, marker='v', markersize=4, color='turquoise')
ax[1,1].set_xticks(np.arange(0,60,15)) 

plt.tight_layout()
plt.savefig(fName)
plt.close('all')
print(f'figure {fName} saved!')

fName = f'utility_heights.png'

plt.figure(figsize = (4,4))
plt.plot(heights, utilu, linestyle='-', lw=1, marker='*', markersize=4, color='crimson')
#plt.set_title("Utility u(h)")
plt.xticks(np.arange(0,60,15)) 
#plt.set_xticklabels([]) 
#plt.set_adjustable('box')
plt.savefig('tmp0.png')
plt.close('all')

#ax01 = ax[0].twinx()
#ax01.plot(heights, usdev,  linestyle='-', lw=1, marker='^', markersize=4, color='cornflowerblue')

plt.figure(figsize = (4,4))
plt.plot(heights, utilv, linestyle='-', lw=1, marker='*', markersize=4, color='crimson')
#plt.set_title("Utility v(h)")
plt.xticks(np.arange(0,60,15)) 
#plt.set_adjustable('box')
plt.savefig('tmp1.png')

#ax11 = ax[1].twinx()
#x11.plot(heights, vsdev, linestyle='-', lw=1, marker='^', markersize=4, color='cornflowerblue')

plt.tight_layout()
plt.savefig(fName)
plt.close('all')
print(f'figure {fName} saved!')
